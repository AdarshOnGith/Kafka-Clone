{
  "info": {
    "name": "Kafka-Clone Testing Collection",
    "description": "API collection for testing Kafka-Clone publish and replication flows",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "item": [
    {
      "name": "Health Check",
      "item": [
        {
          "name": "Broker 1 Health",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "http://localhost:8081/api/v1/storage/health",
              "protocol": "http",
              "host": ["localhost"],
              "port": "8081",
              "path": ["api", "v1", "storage", "health"]
            }
          }
        },
        {
          "name": "Broker 2 Health",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "http://localhost:8082/api/v1/storage/health",
              "protocol": "http",
              "host": ["localhost"],
              "port": "8082",
              "path": ["api", "v1", "storage", "health"]
            }
          }
        },
        {
          "name": "Broker 3 Health",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "http://localhost:8083/api/v1/storage/health",
              "protocol": "http",
              "host": ["localhost"],
              "port": "8083",
              "path": ["api", "v1", "storage", "health"]
            }
          }
        }
      ]
    },
    {
      "name": "Metadata Setup",
      "item": [
        {
          "name": "Populate Metadata - Broker 1",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"brokers\": [\n    {\n      \"id\": 1,\n      \"host\": \"localhost\",\n      \"port\": 8081,\n      \"isAlive\": true,\n      \"lastHeartbeat\": 1703123456789\n    },\n    {\n      \"id\": 2,\n      \"host\": \"localhost\",\n      \"port\": 8082,\n      \"isAlive\": true,\n      \"lastHeartbeat\": 1703123456789\n    },\n    {\n      \"id\": 3,\n      \"host\": \"localhost\",\n      \"port\": 8083,\n      \"isAlive\": true,\n      \"lastHeartbeat\": 1703123456789\n    }\n  ],\n  \"partitions\": [\n    {\n      \"topic\": \"test-topic\",\n      \"partition\": 0,\n      \"leaderId\": 1,\n      \"followerIds\": [2, 3],\n      \"isrIds\": [1, 2, 3],\n      \"leaderEpoch\": 1\n    }\n  ],\n  \"timestamp\": 1703123456789\n}"
            },
            "url": {
              "raw": "http://localhost:8081/api/v1/storage/metadata",
              "protocol": "http",
              "host": ["localhost"],
              "port": "8081",
              "path": ["api", "v1", "storage", "metadata"]
            }
          }
        },
        {
          "name": "Populate Metadata - Broker 2",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"brokers\": [\n    {\n      \"id\": 1,\n      \"host\": \"localhost\",\n      \"port\": 8081,\n      \"isAlive\": true,\n      \"lastHeartbeat\": 1703123456789\n    },\n    {\n      \"id\": 2,\n      \"host\": \"localhost\",\n      \"port\": 8082,\n      \"isAlive\": true,\n      \"lastHeartbeat\": 1703123456789\n    },\n    {\n      \"id\": 3,\n      \"host\": \"localhost\",\n      \"port\": 8083,\n      \"isAlive\": true,\n      \"lastHeartbeat\": 1703123456789\n    }\n  ],\n  \"partitions\": [\n    {\n      \"topic\": \"test-topic\",\n      \"partition\": 0,\n      \"leaderId\": 1,\n      \"followerIds\": [2, 3],\n      \"isrIds\": [1, 2, 3],\n      \"leaderEpoch\": 1\n    }\n  ],\n  \"timestamp\": 1703123456789\n}"
            },
            "url": {
              "raw": "http://localhost:8082/api/v1/storage/metadata",
              "protocol": "http",
              "host": ["localhost"],
              "port": "8082",
              "path": ["api", "v1", "storage", "metadata"]
            }
          }
        },
        {
          "name": "Populate Metadata - Broker 3",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"brokers\": [\n    {\n      \"id\": 1,\n      \"host\": \"localhost\",\n      \"port\": 8081,\n      \"isAlive\": true,\n      \"lastHeartbeat\": 1703123456789\n    },\n    {\n      \"id\": 2,\n      \"host\": \"localhost\",\n      \"port\": 8082,\n      \"isAlive\": true,\n      \"lastHeartbeat\": 1703123456789\n    },\n    {\n      \"id\": 3,\n      \"host\": \"localhost\",\n      \"port\": 8083,\n      \"isAlive\": true,\n      \"lastHeartbeat\": 1703123456789\n    }\n  ],\n  \"partitions\": [\n    {\n      \"topic\": \"test-topic\",\n      \"partition\": 0,\n      \"leaderId\": 1,\n      \"followerIds\": [2, 3],\n      \"isrIds\": [1, 2, 3],\n      \"leaderEpoch\": 1\n    }\n  ],\n  \"timestamp\": 1703123456789\n}"
            },
            "url": {
              "raw": "http://localhost:8083/api/v1/storage/metadata",
              "protocol": "http",
              "host": ["localhost"],
              "port": "8083",
              "path": ["api", "v1", "storage", "metadata"]
            }
          }
        }
      ]
    },
    {
      "name": "Message Publishing",
      "item": [
        {
          "name": "Single Message Publish",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"topic\": \"test-topic\",\n  \"partition\": 0,\n  \"messages\": [\n    {\n      \"key\": \"user123\",\n      \"value\": \"SGVsbG8gV29ybGQ=\",\n      \"timestamp\": 1703123456789\n    }\n  ],\n  \"producerId\": \"producer-1\",\n  \"producerEpoch\": 1,\n  \"requiredAcks\": -1,\n  \"timeoutMs\": 5000\n}"
            },
            "url": {
              "raw": "http://localhost:8081/api/v1/storage/messages",
              "protocol": "http",
              "host": ["localhost"],
              "port": "8081",
              "path": ["api", "v1", "storage", "messages"]
            }
          }
        },
        {
          "name": "Batch Message Publish",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"topic\": \"test-topic\",\n  \"partition\": 0,\n  \"messages\": [\n    {\n      \"key\": \"batch-1\",\n      \"value\": \"TWVzc2FnZSAx\",\n      \"timestamp\": 1703123456789\n    },\n    {\n      \"key\": \"batch-2\",\n      \"value\": \"TWVzc2FnZSAy\",\n      \"timestamp\": 1703123456790\n    },\n    {\n      \"key\": \"batch-3\",\n      \"value\": \"TWVzc2FnZSAz\",\n      \"timestamp\": 1703123456791\n    }\n  ],\n  \"producerId\": \"producer-batch\",\n  \"producerEpoch\": 1,\n  \"requiredAcks\": 1,\n  \"timeoutMs\": 5000\n}"
            },
            "url": {
              "raw": "http://localhost:8081/api/v1/storage/messages",
              "protocol": "http",
              "host": ["localhost"],
              "port": "8081",
              "path": ["api", "v1", "storage", "messages"]
            }
          }
        }
      ]
    },
    {
      "name": "Verification",
      "item": [
        {
          "name": "Check High Water Mark - Broker 1",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "http://localhost:8081/api/v1/storage/partitions/test-topic/0/high-water-mark",
              "protocol": "http",
              "host": ["localhost"],
              "port": "8081",
              "path": ["api", "v1", "storage", "partitions", "test-topic", "0", "high-water-mark"]
            }
          }
        },
        {
          "name": "Check High Water Mark - Broker 2",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "http://localhost:8082/api/v1/storage/partitions/test-topic/0/high-water-mark",
              "protocol": "http",
              "host": ["localhost"],
              "port": "8082",
              "path": ["api", "v1", "storage", "partitions", "test-topic", "0", "high-water-mark"]
            }
          }
        },
        {
          "name": "Check High Water Mark - Broker 3",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "http://localhost:8083/api/v1/storage/partitions/test-topic/0/high-water-mark",
              "protocol": "http",
              "host": ["localhost"],
              "port": "8083",
              "path": ["api", "v1", "storage", "partitions", "test-topic", "0", "high-water-mark"]
            }
          }
        }
      ]
    }
  ]
}